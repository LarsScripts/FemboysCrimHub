local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({
    Title = "ZenWare | Criminality (Seperate GUI)" .. Fluent.Version,
    SubTitle = "By ZenWareScripts",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "Melee Kill Aura", Icon = "" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

local Options = Fluent.Options

local functions = {}
functions.killauraF = false
local maxdist = 20
local attackCooldown = 0.5

local Toggle = Tabs.Main:AddToggle("MeleeKillAura", {
    Title = "Melee Kill Aura",
    Default = functions.killauraF,
})

Toggle:OnChanged(function()
    functions.killauraF = Toggle.Value
    if functions.killauraF then
        killauraL()
    end
end)

local SliderMaxDist = Tabs.Main:AddSlider("MaxDist", {
    Title = "Max Distance",
    Min = 0,
    Max = 25,
    Default = maxdist,
    Rounding = 1,
})

SliderMaxDist:OnChanged(function(Value)
    maxdist = Value
end)

local SliderAttackCooldown = Tabs.Main:AddSlider("AttackCooldown", {
    Title = "Attack Cooldown",
    Min = 0.1,
    Max = 2,
    Default = attackCooldown,
    Rounding = 1,
})

SliderAttackCooldown:OnChanged(function(Value)
    attackCooldown = Value
end)

function killauraL()
    local plrs = game:GetService("Players")
    local me = plrs.LocalPlayer
    local run = game:GetService("RunService")

    local remote1 = game:GetService("ReplicatedStorage").Events["XMHH.2"]
    local remote2 = game:GetService("ReplicatedStorage").Events["XMHH2.2"]

    local lastAttackTimes = {}

    function Attack(target)
        if not (target and target:FindFirstChild("Head")) then return end
        local targetName = target.Name
        if os.clock() - (lastAttackTimes[targetName] or 0) < attackCooldown then return end

        lastAttackTimes[targetName] = os.clock()

        local arg1 = {
            [1] = "ðŸž",
            [2] = tick(),
            [3] = me.Character:FindFirstChildOfClass("Tool"),
            [4] = "43TRFWX",
            [5] = "Normal",
            [6] = tick(),
            [7] = true
        }

        local result = remote1:InvokeServer(unpack(arg1))
        wait(0.3)

        local tool = me.Character:FindFirstChildOfClass("Tool")
        if tool then
            local arg2 = {
                [1] = "ðŸž",
                [2] = tick(),
                [3] = tool,
                [4] = "2389ZFX34",
                [5] = result,
                [6] = false,
                [7] = tool.WeaponHandle,
                [8] = target:FindFirstChild("Head"),
                [9] = target,
                [10] = me.Character:FindFirstChild("HumanoidRootPart").Position,
                [11] = target:FindFirstChild("Head").Position
            }
            local arg3 = {
                [1] = "ðŸž",
                [2] = tick(),
                [3] = tool,
                [4] = "2389ZFX34",
                [5] = result,
                [6] = false,
                [7] = me.Character["Right Arm"],
                [8] = target:FindFirstChild("Head"),
                [9] = target,
                [10] = me.Character:FindFirstChild("Right Arm").Position,
                [11] = target:FindFirstChild("Head").Position
            }
            local toolname = tool.Name
            if toolname ~= "Fists" then
                remote2:FireServer(unpack(arg2))
            else
                remote2:FireServer(unpack(arg3))
            end
        else
            return
        end
    end

    run.RenderStepped:Connect(function()
        if not functions.killauraF then return end

        local mychar = me.Character or me.CharacterAdded:Wait()
        if mychar then
            local myhrp = mychar:FindFirstChild("HumanoidRootPart")
            if myhrp then
                for _, a in ipairs(plrs:GetPlayers()) do
                    if a ~= me then
                        local char = a.Character
                        if char then
                            local hrp = char:FindFirstChild("HumanoidRootPart")
                            if hrp then
                                local distance = (myhrp.Position - hrp.Position).Magnitude
                                if tonumber(distance) < tonumber(maxdist) and 
                                   a.Character and a.Character:FindFirstChildOfClass("Humanoid") and 
                                   a.Character:FindFirstChildOfClass("Humanoid").Health > 15 and 
                                   not char:FindFirstChildOfClass("ForceField") and 
                                   functions.killauraF then
                                    Attack(char)
                                end
                            end
                        end
                    end
                end
            end
        end
    end)
end

SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)

InterfaceManager:SetFolder("FluentKillAura")
SaveManager:SetFolder("FluentKillAura/specific-game")

InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)

Fluent:Notify({
    Title = "ZenWare",
    Content = "The Kill Aura script has been loaded.",
    Duration = 8
})

task.delay(2, function()
    SaveManager:LoadAutoloadConfig()
end)
